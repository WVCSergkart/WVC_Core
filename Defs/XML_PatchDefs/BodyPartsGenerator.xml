<?xml version="1.0" encoding="utf-8"?>
<Defs>

	<XmlExtensions.SlateDef Name="WVC_Slate_BodyPartTypeForPrice" Abstract="True">
		<column>Eye</column>
	</XmlExtensions.SlateDef>

	<!--=====================================================================-->

	<XmlExtensions.PatchDef Name="WVC_BodyPartGenerator" Abstract="True">
		<parameters>
			<!-- WVC_Hediff_BodyPart_Ancient -->
			<li>BdoyPartType</li>
			<!-- WVC_BodyPartAncientBase -->
			<li>BodyPartParentName</li>
		</parameters>
		<apply>

			<Operation Class="XmlExtensions.ForEachDescendant">
				<xpathParent>/Defs/HediffDef[@Name="{BdoyPartType}"]</xpathParent>
				<concreteOnly>true</concreteOnly>
				<storeIn>BodyPart_DEF</storeIn>
				<apply>

			<Operation Class="XmlExtensions.CreateVariable">
				<value>{BodyPart_DEF}/label</value>
				<storeIn>label_DEF</storeIn>
				<fromXml>true</fromXml>
				<apply>

			<Operation Class="XmlExtensions.CreateVariable">
				<value>{BodyPart_DEF}/defName</value>
				<storeIn>defName_DEF</storeIn>
				<fromXml>true</fromXml>
				<apply>

			<Operation Class="XmlExtensions.CreateVariable">
				<value>{BodyPart_DEF}/tags/li</value>
				<storeIn>Tag_DEF</storeIn>
				<fromXml>true</fromXml>
				<apply>

					<!--=====================================================================-->

					<Operation Class="PatchOperationAdd">
						<xpath>/Defs</xpath>
						<value>

						  <ThingDef ParentName="{BodyPartParentName}">
							<defName>{defName_DEF}</defName>
							<label>{label_DEF}</label>
							<descriptionHyperlinks>
								<RecipeDef>Install_{defName_DEF}</RecipeDef>
							</descriptionHyperlinks>
							<statBases>
							</statBases>
							<costList>
							  <Plasteel>25</Plasteel>
							  <ComponentSpacer>5</ComponentSpacer>
							</costList>
						  </ThingDef>

						  <RecipeDef ParentName="WVC_SurgeryInstall_BodyPartBase">
							<defName>Install_{defName_DEF}</defName>
							<label>install {label_DEF}</label>
							<description>Install an {label_DEF}.</description>
							<descriptionHyperlinks>
							  <ThingDef>{defName_DEF}</ThingDef>
							  <HediffDef>{defName_DEF}</HediffDef>
							</descriptionHyperlinks>
							<jobString>Installing {label_DEF}.</jobString>
							<ingredients>
							  <li>
								<filter>
								  <thingDefs>
									<li>{defName_DEF}</li>
								  </thingDefs>
								</filter>
								<count>1</count>
							  </li>
							</ingredients>
							<fixedIngredientFilter>
							  <thingDefs>
								<li>{defName_DEF}</li>
							  </thingDefs>
							</fixedIngredientFilter>
							<appliedOnFixedBodyParts>
							  <li>{Tag_DEF}</li>
							</appliedOnFixedBodyParts>
							<addsHediff>{defName_DEF}</addsHediff>
						  </RecipeDef>

						</value>
					</Operation>

					<!--=====================================================================-->

					<Operation Class="PatchOperationAdd">
						<xpath>/Defs/HediffDef[defName="{defName_DEF}"]</xpath>
						<value>
							<descriptionHyperlinks><ThingDef>{defName_DEF}</ThingDef></descriptionHyperlinks>
							<spawnThingOnRemoved>{defName_DEF}</spawnThingOnRemoved>
						</value>
					</Operation>
					
					<!-- <Operation Class="XmlExtensions.PatchOperationCopy"> -->
						<!-- <xpath>/Defs/ThingDef[@Name="{BodyPartParentName}"]/costList/*</xpath> -->
						<!-- <paste>/Defs/ThingDef[defName="{defName_DEF}"]/costList</paste> -->
					<!-- </Operation> -->

					<!--=====================================================================-->

					<Operation Class="XmlExtensions.PatchByCase">
						<value>{Tag_DEF}</value>
						<cases>

							<li>
								<value>Eye</value>
								<apply>

									<Operation Class="XmlExtensions.PatchOperationMath">
										<xpath>Defs/ThingDef[defName="{defName_DEF}"]/costList/Plasteel</xpath>
										<value>6</value>
										<operation>-</operation>
									</Operation>
									<Operation Class="XmlExtensions.PatchOperationMath">
										<xpath>Defs/ThingDef[defName="{defName_DEF}"]/costList/ComponentSpacer</xpath>
										<value>2</value>
										<operation>-</operation>
									</Operation>

									<Operation Class="PatchOperationAdd">
										<xpath>/Defs/RecipeDef[defName="Install_{defName_DEF}"]/appliedOnFixedBodyParts</xpath>
										<value>
											<li MayRequire="sarg.alphaanimals">AA_BoatEye</li>
											<li MayRequire="wvc.sergkart.nodes">WVC_SightSensor</li>
										</value>
									</Operation>

								</apply>
							</li>
							<li>
								<value>Ear</value>
								<apply>

									<Operation Class="XmlExtensions.PatchOperationMath">
										<xpath>Defs/ThingDef[defName="{defName_DEF}"]/costList/Plasteel</xpath>
										<value>8</value>
										<operation>-</operation>
									</Operation>
									<Operation Class="XmlExtensions.PatchOperationMath">
										<xpath>Defs/ThingDef[defName="{defName_DEF}"]/costList/ComponentSpacer</xpath>
										<value>3</value>
										<operation>-</operation>
									</Operation>

									<Operation Class="PatchOperationAdd">
										<xpath>/Defs/RecipeDef[defName="Install_{defName_DEF}"]/appliedOnFixedBodyParts</xpath>
										<value>
											<li MayRequire="wvc.sergkart.nodes">WVC_HearingSensor</li>
										</value>
									</Operation>

								</apply>
							</li>
							<li>
								<value>Jaw</value>
								<apply>

									<Operation Class="XmlExtensions.PatchOperationMath">
										<xpath>Defs/ThingDef[defName="{defName_DEF}"]/costList/Plasteel</xpath>
										<value>5</value>
										<operation>-</operation>
									</Operation>
									<Operation Class="XmlExtensions.PatchOperationMath">
										<xpath>Defs/ThingDef[defName="{defName_DEF}"]/costList/ComponentSpacer</xpath>
										<value>2</value>
										<operation>-</operation>
									</Operation>

									<Operation Class="PatchOperationAdd">
										<xpath>/Defs/RecipeDef[defName="Install_{defName_DEF}"]/appliedOnFixedBodyParts</xpath>
										<value>
											<li>AnimalJaw</li>
											<li>Beak</li>
											<li MayRequire="wvc.sergkart.nodes">WVC_FormerJaw</li>
											<!-- <li MayRequire="sarg.alphaanimals">AA_CrocodileJaw</li> -->
										</value>
									</Operation>

								</apply>
							</li>
							<li>
								<value>Nose</value>
								<apply>

									<Operation Class="XmlExtensions.PatchOperationMath">
										<xpath>Defs/ThingDef[defName="{defName_DEF}"]/costList/Plasteel</xpath>
										<value>11</value>
										<operation>-</operation>
									</Operation>
									<Operation Class="XmlExtensions.PatchOperationMath">
										<xpath>Defs/ThingDef[defName="{defName_DEF}"]/costList/ComponentSpacer</xpath>
										<value>3</value>
										<operation>-</operation>
									</Operation>

									<Operation Class="PatchOperationAdd">
										<xpath>/Defs/RecipeDef[defName="Install_{defName_DEF}"]/appliedOnFixedBodyParts</xpath>
										<value>
											<li MayRequire="wvc.sergkart.nodes">WVC_SmellSensor</li>
										</value>
									</Operation>

								</apply>
							</li>
							<li>
								<value>Tongue</value>
								<apply>

									<Operation Class="XmlExtensions.PatchOperationMath">
										<xpath>Defs/ThingDef[defName="{defName_DEF}"]/costList/Plasteel</xpath>
										<value>13</value>
										<operation>-</operation>
									</Operation>
									<Operation Class="XmlExtensions.PatchOperationMath">
										<xpath>Defs/ThingDef[defName="{defName_DEF}"]/costList/ComponentSpacer</xpath>
										<value>4</value>
										<operation>-</operation>
									</Operation>

								</apply>
							</li>
							<li>
								<value>Stomach</value>
								<apply>

									<Operation Class="XmlExtensions.PatchOperationMath">
										<xpath>Defs/ThingDef[defName="{defName_DEF}"]/costList/Plasteel</xpath>
										<value>5</value>
										<operation>-</operation>
									</Operation>
									<Operation Class="XmlExtensions.PatchOperationMath">
										<xpath>Defs/ThingDef[defName="{defName_DEF}"]/costList/ComponentSpacer</xpath>
										<value>1</value>
										<operation>-</operation>
									</Operation>

								</apply>
							</li>
							<li>
								<value>Spine</value>
								<apply>

									<Operation Class="XmlExtensions.PatchOperationMath">
										<xpath>Defs/ThingDef[defName="{defName_DEF}"]/costList/Plasteel</xpath>
										<value>5</value>
										<operation>-</operation>
									</Operation>

								</apply>
							</li>
							<li>
								<value>Heart</value>
								<apply>

									<Operation Class="XmlExtensions.PatchOperationMath">
										<xpath>Defs/ThingDef[defName="{defName_DEF}"]/costList/Plasteel</xpath>
										<value>8</value>
										<operation>-</operation>
									</Operation>

									<Operation Class="PatchOperationAdd">
										<xpath>/Defs/RecipeDef[defName="Install_{defName_DEF}"]/appliedOnFixedBodyParts</xpath>
										<value>
											<li MayRequire="nemonian.my">MoyoHeart</li>
											<li>InsectHeart</li>
											<li MayRequire="wvc.sergkart.nodes">WVC_FormerHearth</li>
										</value>
									</Operation>

								</apply>
							</li>
							<li>
								<value>Kidney</value>
								<apply>

									<Operation Class="XmlExtensions.PatchOperationMath">
										<xpath>Defs/ThingDef[defName="{defName_DEF}"]/costList/Plasteel</xpath>
										<value>4</value>
										<operation>-</operation>
									</Operation>
									<Operation Class="XmlExtensions.PatchOperationMath">
										<xpath>Defs/ThingDef[defName="{defName_DEF}"]/costList/ComponentSpacer</xpath>
										<value>1</value>
										<operation>-</operation>
									</Operation>

								</apply>
							</li>
							<li>
								<value>Liver</value>
								<apply>

									<Operation Class="XmlExtensions.PatchOperationMath">
										<xpath>Defs/ThingDef[defName="{defName_DEF}"]/costList/Plasteel</xpath>
										<value>3</value>
										<operation>-</operation>
									</Operation>
									<Operation Class="XmlExtensions.PatchOperationMath">
										<xpath>Defs/ThingDef[defName="{defName_DEF}"]/costList/ComponentSpacer</xpath>
										<value>1</value>
										<operation>-</operation>
									</Operation>

								</apply>
							</li>
							<li>
								<value>Lung</value>
								<apply>

									<Operation Class="XmlExtensions.PatchOperationMath">
										<xpath>Defs/ThingDef[defName="{defName_DEF}"]/costList/Plasteel</xpath>
										<value>6</value>
										<operation>-</operation>
									</Operation>
									<Operation Class="XmlExtensions.PatchOperationMath">
										<xpath>Defs/ThingDef[defName="{defName_DEF}"]/costList/ComponentSpacer</xpath>
										<value>1</value>
										<operation>-</operation>
									</Operation>

								</apply>
							</li>
							<li>
								<value>Shoulder</value>
								<apply>

									<Operation Class="XmlExtensions.PatchOperationMath">
										<xpath>Defs/ThingDef[defName="{defName_DEF}"]/costList/Plasteel</xpath>
										<value>2</value>
										<operation>-</operation>
									</Operation>

									<Operation Class="PatchOperationAdd">
										<xpath>/Defs/RecipeDef[defName="Install_{defName_DEF}"]/appliedOnFixedBodyParts</xpath>
										<value>
											<li MayRequire="vanillaexpanded.vaecaves">VAE_InsectArm</li>
										</value>
									</Operation>

								</apply>
							</li>
							<li>
								<value>Leg</value>
								<apply>

									<Operation Class="XmlExtensions.PatchOperationMath">
										<xpath>Defs/ThingDef[defName="{defName_DEF}"]/costList/Plasteel</xpath>
										<value>1</value>
										<operation>-</operation>
									</Operation>

									<Operation Class="PatchOperationAdd">
										<xpath>/Defs/RecipeDef[defName="Install_{defName_DEF}"]/appliedOnFixedBodyParts</xpath>
										<value>
											<li>InsectLeg</li>
											<li MayRequire="sarg.alphaanimals">AA_SmallInsectLeg</li>
										</value>
									</Operation>

								</apply>
							</li>
							<li>
								<value>Tail</value>
								<apply>

									<Operation Class="XmlExtensions.PatchOperationMath">
										<xpath>Defs/ThingDef[defName="{defName_DEF}"]/costList/Plasteel</xpath>
										<value>3</value>
										<operation>-</operation>
									</Operation>
									<Operation Class="XmlExtensions.PatchOperationMath">
										<xpath>Defs/ThingDef[defName="{defName_DEF}"]/costList/ComponentSpacer</xpath>
										<value>1</value>
										<operation>-</operation>
									</Operation>

									<Operation Class="PatchOperationAdd">
										<xpath>/Defs/RecipeDef[defName="Install_{defName_DEF}"]/appliedOnFixedBodyParts</xpath>
										<value>
											<li MayRequire="nemonian.my">Moyo_Tail</li>
											<li MayRequire="vamv.maruracemod">MR_BigTail</li>
											<li MayRequire="sarg.alphaanimals">AA_InsectTail</li>
											<li MayRequire="vanillaexpanded.vaecaves">VAE_ScorpionTail</li>
										</value>
									</Operation>

								</apply>
							</li>

						</cases>
					</Operation>

					<!--=====================================================================-->

					<Operation Class="XmlExtensions.PatchOperationSafeAdd">
						<xpath>/Defs/ThingDef[@Name="AnimalThingBase"]</xpath>
						<safetyDepth>1</safetyDepth>
						<value>
							<recipes>
								<li>Install_{defName_DEF}</li>
							</recipes>
						</value>
					</Operation>

					<!--=====================================================================-->

					<!-- TEST -->
					<Operation Class="XmlExtensions.FindMod">
						<mods>
							<li>honkai.girls.sergkart</li>
							<li>wvc.sergkart.unstable</li>
						</mods>
						<packageId>true</packageId>
						<logic>and</logic>
						<caseTrue>

							<Operation Class="XmlExtensions.OptionalPatch">
								<modId>honkai.girls.sergkart</modId>
								<key>Extra_TestScenario_AllWeapon_WVC</key>
								<defaultValue>false</defaultValue>
								<caseTrue>

									<Operation Class="PatchOperationAdd">
									  <xpath>/Defs/ScenarioDef[@Name="TEST_Scenario_WVC"]/scenario/parts</xpath>
									  <value>
										<li Class="ScenPart_StartingThing_Defined">
											<def>StartingThing_Defined</def>
											<thingDef>{defName_DEF}</thingDef>
										</li>
									  </value>
									</Operation>

								</caseTrue>
							</Operation>

						</caseTrue>
					</Operation>
					<!-- TEST -->

				</apply>
			</Operation>

				</apply>
			</Operation>

				</apply>
			</Operation>

				</apply>
			</Operation>

		</apply>
	</XmlExtensions.PatchDef>


</Defs>